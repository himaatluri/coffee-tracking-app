<!DOCTYPE html>
<html>
<head>
    <title>Brew Metrics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>â˜•</text></svg>">
    <style>
        :root {
            --primary-color: #8B4513;
            --secondary-color: #D2691E;
            --background-color: #FFFAF5;
            --card-color: #FFFFFF;
            --text-color: #2C1810;
            --border-radius: 16px;
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --container-width: min(95%, 1400px);
            --grid-columns: repeat(auto-fit, minmax(min(100%, 350px), 1fr));
        }

        /* Optimize performance with GPU acceleration */
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
            background-color: var(--background-color);
            background-image: 
                linear-gradient(45deg, #FFFAF5 0%, #FFF5EA 100%),
                radial-gradient(circle at 50% 50%, rgba(139, 69, 19, 0.03) 0%, transparent 100%);
            background-blend-mode: overlay;
            background-attachment: fixed;
            background-size: cover, 15px 15px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            width: var(--container-width);
            margin: 0 auto;
            padding: clamp(1rem, 5vw, 3rem);
            backdrop-filter: blur(10px) saturate(180%);
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.05),
                0 10px 20px rgba(139, 69, 19, 0.1);
        }

        h1 {
            text-align: center;
            color: var(--text-color);
            margin-bottom: 2rem;
            font-weight: 700;
            font-size: clamp(2rem, 5vw, 2.5rem);
        }

        .nav-links {
            text-align: center;
            margin: 2rem 0;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-links a {
            color: var(--primary-color);
            text-decoration: none;
            padding: 0.8rem 1.6rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            background: transparent;
            border: 2px solid var(--primary-color);
            transition: var(--transition);
            min-width: 120px;
        }

        .nav-links a:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .form-section {
            max-width: 800px;
            margin: 0 auto 3rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
        }

        .form-group {
            margin-bottom: 1.5rem;
            display: grid;
            gap: 1rem;
        }

        @media (min-width: 768px) {
            .form-group {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-color);
        }

        input, select {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--card-color);
            backdrop-filter: blur(4px);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(111, 78, 55, 0.1);
            transform: translateY(-1px);
        }

        button {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            max-width: 400px;
            margin: 2rem auto 0;
            display: block;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .records-container {
            display: grid;
            grid-template-columns: var(--grid-columns);
            gap: 2rem;
            margin-top: 3rem;
        }

        .record-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            padding: 1rem;
            position: relative;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .record-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .edit-button {
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .edit-button:hover {
            background-color: #357abd;
        }

        .record-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .record-detail {
            font-size: 1rem;
            color: #555;
        }

        .record-image {
            width: 100%;
            max-height: 300px;
            overflow: hidden;
            border-radius: 4px;
            margin-top: 1rem;
        }

        .record-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }

        /* Delete button styles */
        #deleteRecord {
            background-color: #dc3545;
        }

        #deleteRecord:hover {
            background-color: #c82333;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            max-width: 90%;
            max-height: 90vh;
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .modal-image {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: var(--border-radius);
        }

        .modal-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
            transition: var(--transition);
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 1rem;
            }

            .form-section {
                padding: 1rem;
            }

            .record-card {
                margin-bottom: 1rem;
            }

            .record-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1200px) {
            .records-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 1600px) {
            .records-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Loading animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading skeleton animation */
        @keyframes shimmer {
            0% { background-position: -1000px 0 }
            100% { background-position: 1000px 0 }
        }

        .loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite linear;
        }

        /* Coffee drip animation */
        .coffee-drip {
            position: fixed;
            top: 0;
            right: 5%;
            width: 30px;
            height: 100vh;
            z-index: -1;
            opacity: 0.8;
            pointer-events: none;
        }

        .coffee-stream {
            stroke-dasharray: 400;
            stroke-dashoffset: 400;
            animation: coffee-pour 3s linear infinite;
        }

        .coffee-drop {
            animation: coffee-drip 3s linear infinite;
        }

        @keyframes coffee-pour {
            0% {
                stroke-dashoffset: 400;
            }
            100% {
                stroke-dashoffset: -400;
            }
        }

        @keyframes coffee-drip {
            0% {
                transform: translateY(-380px);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(0);
                opacity: 0;
            }
        }

        .coffee-image {
            display: none;
        }

        /* Edit button styles */
        .edit-button {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            margin-top: 1rem;
            width: auto;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .edit-button:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        /* Edit modal styles */
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .edit-modal-content {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .edit-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
            transition: var(--transition);
        }

        .edit-modal-close:hover {
            transform: rotate(90deg);
        }

        /* Confirmation Modal */
        .confirm-modal, .alert-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .confirm-modal-content, .alert-modal-content {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-primary, .btn-secondary, .btn-danger {
            padding: 0.8rem 1.6rem;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            min-width: 100px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-primary:hover, .btn-secondary:hover, .btn-danger:hover {
            transform: translateY(-2px);
            filter: brightness(110%);
        }

        #alertOk {
            margin-top: 1.5rem;
        }
    </style>
</head>
<body>
    <div class="coffee-drip">
        <svg viewBox="0 0 100 400" preserveAspectRatio="none">
            <path class="coffee-stream" d="M50,0 Q50,200 50,400" stroke="rgba(139, 69, 19, 0.1)" stroke-width="2" fill="none"/>
            <circle class="coffee-drop" cx="50" cy="20" r="3" fill="rgba(139, 69, 19, 0.2)"/>
        </svg>
    </div>
    <div class="container">
        <h1>â˜• Brew Metrics</h1>
        
        <div class="nav-links">
            <a href="/">Home</a>
            <a href="/records">All Records</a>
        </div>

        <div class="form-section" style="display: {{ if .showAll }}none{{ else }}block{{ end }}">
            <h2>Add New Coffee Record</h2>
            <form id="espressoForm">
                <div class="form-group">
                    <label for="coffee">Coffee (grams)</label>
                    <input type="number" id="coffee" name="coffee" required>
                </div>

                <div class="form-group">
                    <label for="water">Water (grams)</label>
                    <input type="number" id="water" name="water">
                </div>

                <div class="form-group">
                    <label for="beans_brand">Coffee Beans Brand</label>
                    <input type="text" id="beans_brand" name="beans_brand" list="brands-list">
                    <datalist id="brands-list">
                        {{ range .brands }}
                            {{ if . }}
                            <option value="{{ . }}">
                            {{ end }}
                        {{ end }}
                    </datalist>
                </div>

                <div class="form-group">
                    <label for="grind_size">Grind Size</label>
                    <input type="number" step="0.1" id="grind_size" name="grind_size">
                </div>

                <div class="form-group">
                    <label for="taste_nodes">Taste Profile</label>
                    <select id="taste_nodes" name="taste_nodes">
                        <option value="">Select taste profile...</option>
                        <option value="Sweet">Sweet</option>
                        <option value="Sour">Sour</option>
                        <option value="Bitter">Bitter</option>
                        <option value="Worst">Worst</option>
                        <option value="Ok-ok">Ok-ok</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="picture">Picture (optional)</label>
                    <input type="file" id="picture" name="picture" accept="image/*">
                    <small class="form-text text-muted">Supported formats: JPG, PNG, GIF (max 5MB)</small>
                </div>

                <button type="submit">Save Coffee Record</button>
            </form>
        </div>

        <div class="records-container">
            <h2>{{ if .showAll }}All Records{{ else }}Recent Records{{ end }}</h2>
            {{ range .records }}
            <div class="record-card" data-record-id="{{ .ID }}">
                <div class="record-details">
                    <div class="record-header">
                        <div class="record-title">Coffee Record #{{ .ID }}</div>
                        <button class="edit-button" onclick="openEditModal(this.closest('.record-card'))">Edit Record</button>
                    </div>
                    <div class="record-info">
                        <div class="record-detail Coffee">Coffee: {{ .Coffee }}g</div>
                        <div class="record-detail Water">Water: {{ .Water }}g</div>
                        <div class="record-detail Ratio">Ratio: {{ printf "%.2f" .Ratio }}</div>
                        {{ if .GrindSize }}
                        <div class="record-detail Grind">Grind Size: {{ .GrindSize }}</div>
                        {{ else }}
                        <div class="record-detail Grind">Grind Size: N/A</div>
                        {{ end }}
                        {{ if .BeansBrand }}
                        <div class="record-detail Beans">Beans Brand: <span class="record-detail-value">{{ .BeansBrand }}</span></div>
                        {{ end }}
                        {{ if .TasteNodes }}
                        <div class="record-detail Taste">Taste Profile: <span class="record-detail-value">{{ .TasteNodes }}</span></div>
                        {{ end }}
                    </div>
                    {{ if .Picture }}
                    <div class="record-image">
                        <img src="data:image/jpeg;base64,{{ .Picture }}" alt="Coffee Record Image" onclick="openImageModal(this)">
                    </div>
                    {{ end }}
                </div>
            </div>
            {{ end }}
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal" id="imageModal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <img class="modal-image" id="modalImage" src="" alt="Full size coffee shot">
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="edit-modal" id="editModal">
        <div class="edit-modal-content">
            <span class="edit-modal-close">&times;</span>
            <h2>Edit Coffee Record</h2>
            <form id="editForm">
                <input type="hidden" id="editRecordId" name="id">
                <div class="form-group">
                    <label for="editCoffee">Coffee (grams)</label>
                    <input type="number" id="editCoffee" name="coffee" required>
                </div>

                <div class="form-group">
                    <label for="editWater">Water (grams)</label>
                    <input type="number" id="editWater" name="water">
                </div>

                <div class="form-group">
                    <label for="editBeansBrand">Coffee Beans Brand</label>
                    <input type="text" id="editBeansBrand" name="beans_brand" list="brands-list">
                </div>

                <div class="form-group">
                    <label for="editGrindSize">Grind Size</label>
                    <input type="number" step="0.1" id="editGrindSize" name="grind_size">
                </div>

                <div class="form-group">
                    <label for="editTasteNodes">Taste Profile</label>
                    <select id="editTasteNodes" name="taste_nodes">
                        <option value="">Select taste profile...</option>
                        <option value="Sweet">Sweet</option>
                        <option value="Sour">Sour</option>
                        <option value="Bitter">Bitter</option>
                        <option value="Worst">Worst</option>
                        <option value="Ok-ok">Ok-ok</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editPicture">New Picture (optional)</label>
                    <input type="file" id="editPicture" name="picture" accept="image/*">
                    <small class="form-text text-muted">Leave empty to keep existing picture</small>
                </div>

                <div class="form-group" style="display: flex; gap: 1rem;">
                    <button type="submit" style="flex: 1;">Update Record</button>
                    <button type="button" id="deleteRecord" style="flex: 1; background: #dc3545;">Delete Record</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-modal-content">
            <h3 id="confirmTitle">Confirm Action</h3>
            <p id="confirmMessage"></p>
            <div class="confirm-buttons">
                <button id="confirmCancel" class="btn-secondary">Cancel</button>
                <button id="confirmOk" class="btn-danger">Delete</button>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div class="alert-modal" id="alertModal">
        <div class="alert-modal-content">
            <h3 id="alertTitle">Notice</h3>
            <p id="alertMessage"></p>
            <button id="alertOk" class="btn-primary">OK</button>
        </div>
    </div>

    <script>
        // API helper function
        async function apiRequest(url, method, data = null) {
            const options = {
                method: method,
                headers: {
                    'Accept': 'application/json'
                }
            };

            if (data) {
                options.headers['Content-Type'] = 'application/json';
                options.body = JSON.stringify(data);
            }

            const response = await fetch(url, options);
            const contentType = response.headers.get('content-type');
            
            if (contentType && contentType.includes('application/json')) {
                const jsonData = await response.json();
                if (!response.ok) {
                    throw new Error(jsonData.error || `Failed to ${method.toLowerCase()} record`);
                }
                return jsonData;
            } else if (!response.ok) {
                throw new Error(`Failed to ${method.toLowerCase()} record`);
            }
            return null;
        }

        // Delete functionality
        deleteButton.addEventListener('click', async function() {
            showConfirmation('Are you sure you want to delete this record? This action cannot be undone.', async () => {
                const recordId = document.getElementById('editRecordId').value;
                console.log('Deleting record:', recordId);
                
                try {
                    await apiRequest(`/records/${recordId}`, 'DELETE');
                    editModal.style.display = 'none';
                    window.location.reload();
                } catch (error) {
                    console.error('Error:', error);
                    showAlert(error.message);
                }
            });
        });

        // Update functionality
        editForm.addEventListener('submit', async function(event) {
            event.preventDefault();

            const recordId = document.getElementById('editRecordId').value;
            console.log('Updating record:', recordId);

            const coffee = document.getElementById('editCoffee').value;
            const water = document.getElementById('editWater').value;
            const beans_brand = document.getElementById('editBeansBrand').value;
            const grind_size = document.getElementById('editGrindSize').value;
            const taste_nodes = document.getElementById('editTasteNodes').value;
            const picture = document.getElementById('editPicture').files[0];

            // Disable submit button and show loading state
            const submitButton = event.target.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.textContent;
            submitButton.disabled = true;
            submitButton.textContent = 'Updating...';

            try {
                const data = {
                    coffee: parseFloat(coffee),
                    water: parseFloat(water),
                    beans_brand: beans_brand,
                    grind_size: parseFloat(grind_size),
                    taste_nodes: taste_nodes
                };

                if (picture) {
                    const base64 = await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.readAsDataURL(picture);
                    });
                    data.picture = base64;
                }

                console.log('Sending update request for record:', recordId, 'with data:', data);
                const response = await fetch(`/records/${recordId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error || 'Failed to update record');
                }

                // Close modal and reload page
                editModal.style.display = 'none';
                window.location.reload();
            } catch (error) {
                console.error('Error:', error);
                showAlert(error.message || 'Error updating record. Please try again.');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = originalButtonText;
            }
        });

        // Create functionality
        document.getElementById('espressoForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const coffee = document.getElementById('coffee').value;
            const water = document.getElementById('water').value;
            const beans_brand = document.getElementById('beans_brand').value;
            const grind_size = document.getElementById('grind_size').value;
            const taste_nodes = document.getElementById('taste_nodes').value;
            const picture = document.getElementById('picture').files[0];

            // Disable submit button and show loading state
            const submitButton = event.target.querySelector('button[type="submit"]');
            const originalButtonText = submitButton.textContent;
            submitButton.disabled = true;
            submitButton.textContent = 'Saving...';

            try {
                const data = {
                    coffee: parseFloat(coffee),
                    water: parseFloat(water),
                    beans_brand: beans_brand,
                    grind_size: parseFloat(grind_size),
                    taste_nodes: taste_nodes
                };

                if (picture) {
                    const base64 = await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.readAsDataURL(picture);
                    });
                    data.picture = base64;
                }

                await apiRequest('/records', 'POST', data);
                event.target.reset();
                window.location.reload();
            } catch (error) {
                console.error('Error:', error);
                showAlert(error.message);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = originalButtonText;
            }
        });

        // Modal functionality
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');
        const closeBtn = document.querySelector('.modal-close');

        function openModal(imgSrc) {
            modal.style.display = 'flex';
            modalImg.src = imgSrc;
        }

        closeBtn.onclick = function() {
            modal.style.display = 'none';
        }

        modal.onclick = function(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Edit Modal functionality
        const editModal = document.getElementById('editModal');
        const editForm = document.getElementById('editForm');
        const editModalClose = document.querySelector('.edit-modal-close');
        const deleteButton = document.getElementById('deleteRecord');

        function openEditModal(recordCard) {
            const recordId = recordCard.dataset.recordId;
            console.log('Opening edit modal for record:', recordId, 'card:', recordCard); // Debug log
            
            // Safely get values with fallbacks
            const coffeeElement = recordCard.querySelector('[class*="Coffee"]');
            const waterElement = recordCard.querySelector('[class*="Water"]');
            const grindElement = recordCard.querySelector('[class*="Grind"]');
            const beansElement = recordCard.querySelector('[class*="Beans"] .record-detail-value');
            const tasteElement = recordCard.querySelector('[class*="Taste"] .record-detail-value');

            // Extract numeric values using regex
            const extractNumber = (text) => {
                if (!text) return '';
                const match = text?.match(/[\d.]+/);
                return match ? match[0] : '';
            };

            // Clean up text content and log values
            const coffee = extractNumber(coffeeElement?.textContent);
            const water = extractNumber(waterElement?.textContent);
            const grindSize = extractNumber(grindElement?.textContent);
            const beansBrand = beansElement?.textContent?.trim() || '';
            const tasteNodes = tasteElement?.textContent?.trim() || '';

            console.log('Extracted values:', {
                recordId,
                coffee,
                water,
                grindSize,
                beansBrand,
                tasteNodes
            });

            // Set form values
            document.getElementById('editRecordId').value = recordId;
            document.getElementById('editCoffee').value = coffee;
            document.getElementById('editWater').value = water;
            document.getElementById('editGrindSize').value = grindSize;
            document.getElementById('editBeansBrand').value = beansBrand;
            document.getElementById('editTasteNodes').value = tasteNodes;

            editModal.style.display = 'flex';
        }

        // Close modal handlers
        editModalClose.onclick = function() {
            editModal.style.display = 'none';
        }

        editModal.onclick = function(e) {
            if (e.target === editModal) {
                editModal.style.display = 'none';
            }
        }

        const confirmModal = document.getElementById('confirmModal');
        const alertModal = document.getElementById('alertModal');

        function showConfirmation(message, onConfirm) {
            document.getElementById('confirmMessage').textContent = message;
            confirmModal.style.display = 'flex';

            document.getElementById('confirmOk').onclick = () => {
                confirmModal.style.display = 'none';
                onConfirm();
            };

            document.getElementById('confirmCancel').onclick = () => {
                confirmModal.style.display = 'none';
            };

            // Close on backdrop click
            confirmModal.onclick = (e) => {
                if (e.target === confirmModal) {
                    confirmModal.style.display = 'none';
                }
            };
        }

        function showAlert(message) {
            document.getElementById('alertMessage').textContent = message;
            alertModal.style.display = 'flex';

            document.getElementById('alertOk').onclick = () => {
                alertModal.style.display = 'none';
            };

            // Close on backdrop click
            alertModal.onclick = (e) => {
                if (e.target === alertModal) {
                    alertModal.style.display = 'none';
                }
            };
        }
    </script>
</body>
</html>